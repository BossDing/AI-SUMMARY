#### 电商数据模型上的聚合
#### 聚合性能和限制
#### 其他聚合功能

#### MongoDB聚合框架， 第一次在MongoDB 2.2使用。 为调用聚合框架就需要定义一个管道。 聚合管道里的每一步输出都作为下一步的输入。 每一步都在输入文档执行单个操作并生成输出文档。  聚合框架是MongoDB的高级查询语言， 它允许我们通过转换和合并多个文档中的数据来生成新的在单个文档里不存在的文档信息。    

##### 聚合管道操作包括以下几个部分：             
```
$project    -->     指定输出文档里的字段
$match      -->     选择要处理的文档， 与find类似
$limit      -->     限制传递给下一步的文档数量
$skip       -->     跳过一定数量的文档
$unwind     -->     扩展数组， 为每个数组入口生成一个输出文档
$group      -->     根据key来分组文档
$sort       -->     排序文档
$geoNear    -->     选择某个地理位置附近的文档
$out        -->     把管道的结果与写入某个集合（2.6新增）
$redact     -->     控制特定数据的访问（2.6新增）

// 例
db.products.aggregate([ {$match: ...}, {$group: ...}, {$sort: ...} ]);

1、 整个商品集合传递给$match， 只从输入集合里选择一部分文档             
2、$match的输出结果传递给$group操作符， 然后根据key来进行排序， 提供新的信息， 比如求综合和平均值等等           
3、$group的输出结果传递给$sort操作符， 然后将排序结果返回给最终的结果。
```